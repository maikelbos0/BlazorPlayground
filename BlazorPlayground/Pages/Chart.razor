@page "/chart"
@using BlazorPlayground.Chart

<h1>Chart</h1>

<div class="btn-toolbar">
    <fieldset class="btn-group mb-3 me-3">
        <button type="button" class="btn btn-secondary" @onclick="AddDataSeries">Add data series</button>
        <button type="button" class="btn btn-secondary" @onclick="AddDataPoint">Add data point</button>
        <button type="button" class="btn btn-secondary" @onclick="GenerateData">Generate data</button>
        <button type="button" class="btn btn-secondary" @onclick="XYChart.AutoScale">Auto scale plot area</button>
    </fieldset>

    <fieldset class="input-group mb-3 me-3">
        <div class="input-group-text">Canvas dimensions</div>

        <div class="input-group-text">
            <label for="width">Width</label>
        </div>

        <input type="text" class="form-control" id="width" @bind-value="XYChart.Canvas.Width" />

        <div class="input-group-text">
            <label for="height">Height</label>
        </div>

        <input type="text" class="form-control" id="height" @bind-value="XYChart.Canvas.Height" />

        <div class="input-group-text">
            <label for="padding">Padding</label>
        </div>

        <input type="text" class="form-control" id="padding" @bind-value="XYChart.Canvas.Padding" />

        <div class="input-group-text">
            <label for="yAxisLabelWidth">Y-axis label width</label>
        </div>

        <input type="text" class="form-control" id="yAxisLabelWidth" @bind-value="XYChart.Canvas.YAxisLabelWidth" />

        <div class="input-group-text">
            <label for="yAxisLabelClearance">Y-axis label clearance</label>
        </div>

        <input type="text" class="form-control" id="yAxisLabelClearance" @bind-value="XYChart.Canvas.YAxisLabelClearance" />

        <div class="input-group-text">
            <label for="xAxisLabelHeight">X-axis label height</label>
        </div>

        <input type="text" class="form-control" id="xAxisLabelHeight" @bind-value="XYChart.Canvas.XAxisLabelHeight" />

        <div class="input-group-text">
            <label for="xAxisLabelClearance">X-axis label clearance</label>
        </div>

        <input type="text" class="form-control" id="xAxisLabelClearance" @bind-value="XYChart.Canvas.XAxisLabelClearance" />
    </fieldset>

    <fieldset class="input-group mb-3 me-3">
        <div class="input-group-text">Plot area</div>

        <div class="input-group-text">
            <label for="yAxisMin">Min</label>
        </div>

        <input type="text" class="form-control" id="yAxisMin" @bind-value="XYChart.PlotArea.Min" />

        <div class="input-group-text">
            <label for="yAxisMax">Max</label>
        </div>

        <input type="text" class="form-control" id="yAxisMax" @bind-value="XYChart.PlotArea.Max" />

        <div class="input-group-text">
            <label for="yAxisGridLineInterval">Grid line interval</label>
        </div>

        <input type="text" class="form-control" id="yAxisGridLineInterval" @bind-value="XYChart.PlotArea.GridLineInterval" />
    </fieldset>
</div>

<table class="mb-3">
    <tr>
        <th></th>

        @for (var y0 = 0; y0 < XYChart.DataSeries.Count; y0++) {
            var y = y0;

            <th>
                <input type="text" class="form-control" @bind-value="XYChart.DataSeries[y].Name" />
            </th>
        }
    </tr>

    @for (var x0 = 0; x0 < XYChart.Labels.Count; x0++) {
        var x = x0;

        <tr>
            <th>
                <input type="text" class="form-control" @bind-value="XYChart.Labels[x]" />
            </th>

            @for (var y0 = 0; y0 < XYChart.DataSeries.Count; y0++) {
                var y = y0;

                <td>
                    <input type="text" class="form-control" @bind-value="XYChart.DataSeries[y][x]" />
                </td>
            }
        </tr>
    }
</table>

<ChartRenderer Chart="XYChart"/>

@code {
    private XYChart XYChart = new();

    protected override void OnInitialized() {
        base.OnInitialized();

        XYChart.Labels.Add("");
        XYChart.DataSeries.Add(new DataSeries("") { null });
    }

    private void AddDataSeries() {
        var dataSeries = new DataSeries("");
        dataSeries.AddRange(XYChart.Labels.Select(l => (double?)null));
        XYChart.DataSeries.Add(dataSeries);
    }

    private void AddDataPoint() {
        XYChart.Labels.Add("");

        foreach (var dataSeries in XYChart.DataSeries) {
            dataSeries.Add(null);
        }
    }

    private void GenerateData() {
        var random = new Random();

        for (var x = 0; x < XYChart.Labels.Count; x++) {
            XYChart.Labels[x] = $"Value {x + 1}";
        }

        for (var y = 0; y < XYChart.DataSeries.Count; y++) {
            if (string.IsNullOrWhiteSpace(XYChart.DataSeries[y].Name)) {
                XYChart.DataSeries[y].Name = $"Series {y + 1}";
            }

            for (var x = 0; x < XYChart.DataSeries[y].Count; x++) {
                if (XYChart.DataSeries[y][x] == null) {
                    XYChart.DataSeries[y][x] = random.Next(-100, 900);
                }
            }
        }
    }
}